{% extends "base.html" %}
{% load static %}
{% block title %}Iniciar sesión{% endblock %}

{% block content %}
<div class="row justify-content-center">
  <div class="col-12 col-md-6 col-lg-4">
    <h1 class="h3 mb-3">Iniciar sesión</h1>

    {% if PI_ONLY_LOGIN %}
      <div class="alert alert-info">
        Josefedev-JFGC está bajo revisión del Core Team, acceso <strong>solo con Pi</strong>.
      </div>

      <button id="btn-pi-login"
              class="cta-button cta-section px-4 py-2 w-100"
              type="button"
              data-login-url="{% url 'users:pi_login' %}"
              data-redirect-url="{% url 'users:profile' %}">
        Iniciar sesión con Pi
      </button>

      <div class="mt-3 small text-muted">
        ¿Problemas? Abre esta app desde <strong>Pi Browser</strong> y vuelve a intentarlo.
      </div>

    {% else %}
      <form id="login-form" method="post" novalidate>
        {% csrf_token %}
        {{ form.non_field_errors }}

        <div class="mb-3">
          <label class="form-label">Usuario</label>
          {{ form.username }}
        </div>
        <div class="mb-3">
          <label class="form-label">Contraseña</label>
          {{ form.password }}
        </div>

        {{ form.recaptcha_token }}
        <button class="btn btn-primary w-100" type="submit">Entrar</button>
      </form>

      <div class="mt-3">
        <div class="d-flex align-items-start gap-2 small text-muted border rounded-3 p-3 bg-light">
          <svg width="18" height="18" viewBox="0 0 24 24" aria-hidden="true" class="mt-1">
            <path d="M12 2l7 3v6c0 5-3.8 9.7-7 11-3.2-1.3-7-6-7-11V5l7-3z" fill="currentColor" opacity=".15"></path>
            <path d="M12 2l7 3v6c0 5-3.8 9.7-7 11-3.2-1.3-7-6-7-11V5l7-3zm0 2.2L7 5.3v5.6c0 3.9 2.8 8 5 9.3 2.2-1.3 5-5.4 5-9.3V5.3l-5-1.1zM10.9 14.6l-2.1-2.1 1.4-1.4 1.4 1.4 3.3-3.3 1.4 1.4-4.7 4.7z" fill="currentColor"></path>
          </svg>
          <div>
            <div class="fw-semibold">Protección activa con Google reCAPTCHA v3</div>
            <div>
              Esta página está protegida por reCAPTCHA y se aplican la
              <a class="link-secondary" href="https://policies.google.com/privacy" target="_blank" rel="noopener noreferrer">Política de Privacidad</a>
              y los
              <a class="link-secondary" href="https://policies.google.com/terms" target="_blank" rel="noopener noreferrer">Términos de Servicio</a>
              de Google.
            </div>
          </div>
        </div>
      </div>
    {% endif %}
  </div>
</div>
{% endblock %}

{% block extra_scripts %}
  {% if not PI_ONLY_LOGIN %}
    <script src="https://www.google.com/recaptcha/api.js?render={{ RECAPTCHA_SITE_KEY }}"></script>
    <script src="{% static 'js/users/recaptcha-login.js' %}"></script>
  {% endif %}

  {# lógica de login con Pi (sin inline) #}
  <script src="{% static 'js/users/pi-login.js' %}"></script>
{% endblock %}
