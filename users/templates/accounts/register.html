{% extends "base.html" %}
{% load static %}
{% block title %}Registro{% endblock %}

{% block content %}
<div class="row justify-content-center">
  <div class="col-12 col-md-6 col-lg-5">
    <h1 class="h3 mb-3">Crear cuenta</h1>
    <form id="register-form" method="post" novalidate>
      {% csrf_token %}
      {{ form.non_field_errors }}

      <div class="mb-3">
        <label class="form-label">Usuario</label>
        {{ form.username }}
        {{ form.username.errors }}
      </div>

      <div class="mb-3">
        <label class="form-label">Email</label>
        {{ form.email }}
        {{ form.email.errors }}
      </div>

      <div class="mb-3">
        <label class="form-label">Contraseña</label>
        {{ form.password1 }}
        {{ form.password1.errors }}
      </div>

      <div class="mb-3">
        <label class="form-label">Repite contraseña</label>
        {{ form.password2 }}
        {{ form.password2.errors }}
      </div>

      {{ form.recaptcha_token }} {# <- importantísimo #}

      <button class="cta-button cta-section px-4 py-2 w-100" type="submit">Registrarme</button>
    </form>

      <!-- Aviso reCAPTCHA con tarjeta ligera e icono -->
      <div class="mt-3">
        <div class="d-flex align-items-start gap-2 small text-muted border rounded-3 p-3 bg-light">
          <!-- Shield Check (inline SVG) -->
          <svg width="18" height="18" viewBox="0 0 24 24" aria-hidden="true" focusable="false" class="mt-1">
            <path d="M12 2l7 3v6c0 5-3.8 9.7-7 11-3.2-1.3-7-6-7-11V5l7-3z" fill="currentColor" opacity=".15"></path>
            <path d="M12 2l7 3v6c0 5-3.8 9.7-7 11-3.2-1.3-7-6-7-11V5l7-3zm0 2.2L7 5.3v5.6c0 3.9 2.8 8 5 9.3 2.2-1.3 5-5.4 5-9.3V5.3l-5-1.1zM10.9 14.6l-2.1-2.1 1.4-1.4 1.4 1.4 3.3-3.3 1.4 1.4-4.7 4.7z" fill="currentColor"></path>
          </svg>
          <div>
            <div class="fw-semibold">Protección activa con Google reCAPTCHA v3</div>
            <div>
              Esta página está protegida por reCAPTCHA y se aplican la
              <a class="link-secondary" href="https://policies.google.com/privacy" rel="noopener noreferrer" target="_blank">Política de Privacidad</a>
              y los
              <a class="link-secondary" href="https://policies.google.com/terms" rel="noopener noreferrer" target="_blank">Términos de Servicio</a>
              de Google.
            </div>
          </div>
        </div>
      </div>

      <!-- Acciones de cuenta en una “barra” elegante -->
      <div class="mt-3">
        <div class="d-flex flex-column flex-sm-row justify-content-between align-items-start align-items-sm-center gap-2 border rounded-3 p-3">
          <div class="d-flex align-items-center gap-2">
            <!-- Log-in (inline SVG) -->
            <svg width="18" height="18" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
              <path d="M4 4h9a3 3 0 013 3v2h-2V7a1 1 0 00-1-1H6a1 1 0 00-1 1v10a1 1 0 001 1h7a1 1 0 001-1v-2h2v2a3 3 0 01-3 3H4a3 3 0 01-3-3V7a3 3 0 013-3z" fill="currentColor" opacity=".15"></path>
              <path d="M12 11V8l6 4-6 4v-3H8v-2h4zM4 4h9a3 3 0 013 3v2h-2V7a1 1 0 00-1-1H6a1 1 0 00-1 1v10a1 1 0 001 1h7a1 1 0 001-1v-2h2v2a3 3 0 01-3 3H4a3 3 0 01-3-3V7a3 3 0 013-3z" fill="currentColor"></path>
            </svg>
            <span class="small">¿Ya tienes cuenta?</span>
            <a class="btn btn-sm btn-outline-primary" href="{% url 'users:login' %}{% if request.GET.next %}?next={{ request.GET.next }}{% endif %}">
              Inicia sesión
            </a>
          </div>
          <div>
            <a class="small link-primary" href="{% url 'users:password_reset' %}">
              ¿Olvidaste tu contraseña?
            </a>
          </div>
        </div>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_scripts %}
  <script src="https://www.google.com/recaptcha/api.js?render={{ RECAPTCHA_SITE_KEY }}"></script>
  <script src="{% static 'js/recaptcha-register.js' %}"></script>
{% endblock %}
